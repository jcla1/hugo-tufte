<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
{{ if (isset .Params "description") }}
<meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}">
{{ end }}
<title>{{ if not .IsHome }}{{ .Title  }} - {{ end }}{{ .Site.Title }}</title>

<link rel="canonical" href="{{ .Permalink }}" />
{{ if .Site.Params.favicon }}
<link rel="icon" href="{{ .Site.Params.favicon | absURL }}" />
{{ end }}

{{ partial "json-ld/main.html" . }}

{{- $css := slice (resources.Get "css/fonts.css" | resources.ExecuteAsTemplate "fonts.css" .) (resources.Get "css/modern-normalize.css") -}}
{{- $scssStyle := resources.Get "scss/hugo-tufte.scss" | resources.ExecuteAsTemplate "main.scss" .  | resources.ToCSS -}}

{{- $css = $css | append $scssStyle | resources.Concat "css/main.css" | resources.PostCSS -}}

{{ if hugo.IsProduction }}
{{ $css = $css | minify | fingerprint | resources.PostProcess }}
<link href="{{ $css.RelPermalink }}" rel="stylesheet" integrity="{{ $css.Data.Integrity }}" />
{{ else }}
<link href="{{ $css.RelPermalink }}" rel="stylesheet" />
{{ end }}

{{- with .OutputFormats.Get "rss" -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
{{- end -}}
</head>
